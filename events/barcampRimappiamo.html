<!DOCTYPE html>
<html lang="it-IT">
<head>
<meta charset="UTF-8"/>
<title>BarCamp</title>

<script type="text/javascript" src="../script/leaflet.js"></script>
<script type="text/javascript" src="../script/map.js"></script>
<script type="text/javascript" src="../script/underscore-min.js"></script>
<script type="text/javascript" src="../script/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../script/jquery.geo.min.js"></script>
<script type="text/javascript" src="../script/jquery.debounce-1.0.5.js"></script>
<link rel="stylesheet" href="../script/leaflet.css" />
<link rel="stylesheet" href="../script/sherlock.css" />
</head>

<body class='section-0'>

<div id='pane'>
    <div id='map'></div>
</div>

<article>
  <section id='cover' class='cover active'>
    <h1>Rimappiamo la città</h1>
    <p>Palazzo Ducale, Genova 11 Maggio 2013</p>
    <small>Map icons by <a href="http://mapicons.nicolasmollet.com/">Nicholas Mollet</a>, Visualization derived from <a href="http://mapbox.com/tutorial-sherlock/">MapBox's Sherlock</a>, Map data &copy; OpenStreetMap Contributors</small>
    <small class='scroll'>Scroll con il mouse ▼</small>
  </section>
  <section id='id1' class="">
    <h2></h2>
    <p></p>
  </section>
  <section id='id2' class="">
    <h2></h2>
    <p></p>
  </section>
  <section id='id3' class="">
    <h2></h2>
    <p></p>
  </section>
  <section id='id4' class="">
    <h2></h2>
    <p></p>
  </section>
  <section id='id5' class="">
    <h2></h2>
    <p></p>
  </section>
  <section id='id6' class="">
    <h2></h2>
    <p></p>
  </section>
  <section id='id7' class="">
    <h2></h2>
    <p></p>
  </section>
  <section id='id8' class="">
    <h2></h2>
    <p></p>
  </section>
  <section id='id9' class="">
    <h2></h2>
    <p></p>
  </section>
  <section id='id10' class="">
    <h2></h2>
    <p></p>
  </section>
  <section id='id11' class="">
    <h2></h2>
    <p></p>
  </section>
  <section id='id12' class="">
    <h2></h2>
    <p></p>
  </section>
  <section id='id13' class="">
    <h2></h2>
    <p></p>
  </section>
  <section id='id14' class="">
    <h2></h2>
    <p></p>
  </section>
  <section id='id15' class="">
    <h2></h2>
    <p></p>
  </section>
</article>

</body>

<script>
var map = initmap(44.412,8.931,16, { zoomControl:false });


var cat=
{
    'riqu':{'name':"Riqualificazione spazi pubblici", "icon": '../icons/grass.png'},
    'bamb':{'name':"Bambini ed anziani", "icon": '../icons/family.png'},
    'conn':{'name':"Diffusione connettività", "icon": '../icons/wifi.png'},
    'ambi':{'name':"Ambiente ed energia", "icon": '../icons/markerFuc.png'},
    'info':{'name':"Alfabetizzazione informatica", "icon": '../icons/computers.png'},
    'arte':{'name':"Arte e cultura", "icon": '../icons/sight-2.png'},
    'quar':{'name':"Nel mio quartiere", "icon": '../icons/home-2.png'},
    'cowo':{'name':"Condivisione spazi", "icon": '../icons/share.png'},
    'open':{'name':"Open Source ed affini", "icon": '../icons/wiki-export.png'},
    'mobi':{'name':"Mobilità sostenibile", "icon": '../icons/cycling.png'}
}

var iniziative=
{
    "id1": {"lat":"44.4056156", "lon":"8.936709", "zoom":16, "title":"Coworking a Genova", "text":"L'ufficio di Acropoli Immobiliare, una delle sedi che forniscono servizio di coworking a Genova, è uno degli spazi in cui i laboratori di OpenGenova possono incontrarsi per lo sviluppo dei progetti", 'cat': 'cowo'},
    "id2": {"lat":"44.3905805", "lon":"8.9999391", "zoom":16, "title":"Villa Stalder", "text":"I giardini di Villa Stalder sono stati risistemati dai bambini durante un evento dei mesi passati", 'cat': 'riqu'},
    "id3": {"lat":"44.4069081", "lon":"8.9641328", "zoom":16, "title":"ALID", "text":"Il progetto scuole di Alid porta Linux e computer rigenerati gratuitamente nelle scuole di Genova", 'cat': 'open'},
    "id4": {"lat":"44.4120618", "lon":"8.9288162", "zoom":16, "title":"Il CicloRiparo", "text":"Anemmu in bici a Zena promuove l'uso della bicicletta a Genova ed organizza gli Apericicli ed il Cicloriparo", 'cat': 'mobi'},
   "id5": {"lat":"44.3986846", "lon":"8.947853", "zoom":16, "title":"Associazione Y.E.A.S.T.", "text":"L'associazione Youth Europe Around Sustainability Tables è una associazione che promuove la mobilità internazionale ed il territorio ligure", 'cat': 'mobi'},
    "id6": {"lat":"44.4275552", "lon":"8.743928", "zoom":16, "title":"Farmacia Serra", "text":"La farmacia Serra utilizza la rete ed i social in modo innovativo per fare informazione sulla salute e rispondere alle domande", 'cat': 'bamb'},
    "id7": {"lat":"44.4180099", "lon":"8.9618006", "zoom":16, "title":"Bike Charger per Smart City", "text":"Punti di ricarica per la promozione della mobilità elettrica", 'cat': 'mobi'},
    "id8": {"lat":"44.4423399", "lon":"9.1376354", "zoom":16, "title":"Goa Jam Lab", "text":"Laboratorio di recupero creativo di capi di abbigliamento e tessuti per donne fuori mercato del lavoro", 'cat': 'arte'},
    "id9": {"lat":"44.4180099", "lon":"8.9618006", "zoom":16, "title":"GecoEco", "text":"Noleggio di biciclette elttriche, consulenze per la trasformazione in bici elettriche", 'cat': 'mobi'},
    "id10": {"lat":"44.4202582", "lon":"8.9203823", "zoom":16, "title":"Ripercussioni Sociali", "text":"Associazione di promozione sociale per la cultura musicale e l'integrazione", 'cat': 'arte'},
    "id11": {"lat":"44.410771", "lon":"8.8900889", "zoom":16, "title":"Dammi del tu", "text":"Ristorante che propone laboratori artistici e mostre pittoriche e fotografiche e piccoli spettacoli teatrali e musicali", 'cat': 'arte'},
    "id12": {"lat":"44.4555102", "lon":"8.8996995", "zoom":16, "title":"Vivilo Amalo Adottalo", "text":"Progetto per il verde della Valpolcevera", 'cat': 'riqu'},
    "id13": {"lat":"44.3957277", "lon":"8.9514359", "zoom":16, "title":"Eco Bike Courier", "text":"Corrieri in bicicletta", 'cat': 'mobi'},
    "id14": {"lat":"44.4100376", "lon":"8.9317304", "zoom":16, "title":"Associazione Abitanti della Maddalena", "text":"Associazione attiva nella riqualificazione del territorio <a href='http://www.amaddalena.org'>amaddalena.org</a>", 'cat': 'riqu'},
    "id15": {"lat":"44.410771", "lon":"8.8900889", "zoom":16, "title":"Cucina cultura", "text":"Tradizione ed innovazione nella cucina vegetariana", 'cat': 'arte'},
}

var sections = document.getElementsByTagName('section');

var setActive = function(index, ease) {

  $.each(sections,function(i,s) { s.className = s.className.replace(' active', '') });
  
    sections[index].className += ' active';
      document.body.className = 'section-' + index;
      
      var obj=iniziative[sections[index].id];
               if (typeof obj==="undefined") return;
     if (typeof layer!=="undefined")     removeMarker(map,layer);
              
              var icon= makeIcon(cat[obj["cat"]]["icon"]);
     layer= putMarker(map,icon,obj["lat"],obj["lon"],obj["text"]);
     
          map.panTo([obj['lat'],obj['lon']]);
            map.setZoom(obj['zoom']);
     $(sections[index]).find("h2").html(obj["title"]);     
    $(sections[index]).find("p").html(obj["text"]);

      return true;
};

window.onscroll = $.debounce(function() {
  // IE 8
  if (window.pageYOffset === undefined) {
    var y = document.documentElement.scrollTop;
    var h = document.documentElement.clientHeight;
  } else {
    var y = window.pageYOffset;
    var h = window.innerHeight;
  }

  if (y === 0) return setActive(0, true);

  var memo = 0;
  var buffer = (h * 0.3333);

  var active = _(sections).any(function(el, index) {
    memo += el.offsetHeight;
    return y < (memo-buffer) ? setActive(index, true) : false;
  });


  if (!active) setActive(sections.length - 1, true);
},10);


setActive(0, false);
</script>

</html>
